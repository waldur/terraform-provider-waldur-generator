package {{ .Package }}

{{ if ne .Package "common" }}
import (
	"encoding/json"
	"github.com/waldur/terraform-provider-waldur/internal/sdk/common"
)
{{ end }}

{{ range .SharedStructs }}
type {{ .RefName }} struct {
	{{ template "sdkStructFields" dict "Fields" .Properties "Prefix" .RefName "Package" $.Package }}
}
{{ template "sdkNestedStructs" dict "Fields" .Properties "Prefix" .RefName "Package" $.Package }}
{{ end }}

{{ range .Resources }}
type {{ .Name | title }}CreateRequest struct {
	{{- $createPrefix := printf "%sCreate" (.Name | title) }}
	{{- if .IsOrder }}
	{{- range .CreateFields }}
	{{- if not (isOrderAttribute .Name) }}
	{{ .Name | title }} {{ renderGoType . $.Package $createPrefix "Request" }} `json:"{{ .Name }}{{ if not .Required }},omitempty{{ end }}"`
	{{- end }}
	{{- end }}
	Attributes {{ .Name | title }}CreateAttributes `json:"attributes"`
	{{- else }}
	{{ template "sdkStructFields" dict "Fields" .CreateFields "Prefix" (printf "%sCreate" (.Name | title)) "Package" $.Package }}
	{{- end }}
}

{{- if .IsOrder }}
type {{ .Name | title }}CreateAttributes struct {
	{{ template "sdkAttributesStructFields" dict "Fields" .CreateFields "Prefix" (printf "%sCreate" (.Name | title)) "Package" $.Package }}
}
{{- end }}

{{ template "sdkNestedStructs" dict "Fields" .CreateFields "Prefix" (printf "%sCreate" (.Name | title)) "Package" $.Package }}

{{- if .UpdateFields }}
type {{ .Name | title }}UpdateRequest struct {
	{{ template "sdkStructFields" dict "Fields" .UpdateFields "Prefix" (printf "%sUpdate" (.Name | title)) "Package" $.Package }}
}
{{ template "sdkNestedStructs" dict "Fields" .UpdateFields "Prefix" (printf "%sUpdate" (.Name | title)) "Package" $.Package }}
{{- end }}

{{- $resName := .Name }}
{{- $modelFields := .ModelFields }}
{{- $pkgName := $.Package }}
{{- range $action := .UpdateActions }}
{{- $actionParamField := index $modelFields 0 }}
{{- $found := false }}
{{- range $field := $modelFields }}
	{{- if eq $field.Name $action.Param }}{{ $found = true }}{{ $actionParamField = $field }}{{ end }}
{{- end }}
{{- if $found }}
type {{ $resName | title }}{{ $action.Name | title }}ActionRequest struct {
	{{ $actionParamField.Name | title }} {{ if eq $actionParamField.Type "string" }}*string{{ else if eq $actionParamField.Type "integer" }}*int64{{ else if eq $actionParamField.Type "boolean" }}*bool{{ else if eq $actionParamField.Type "number" }}*float64{{ else if eq $actionParamField.Type "array" }}{{ if eq $actionParamField.ItemType "string" }}[]string{{ else if eq $actionParamField.ItemType "integer" }}[]int64{{ else }}{{ if $actionParamField.ItemSchema.RefName }}{{ if ne $pkgName "common" }}[]common.{{ $actionParamField.ItemSchema.RefName }}{{ else }}[]{{ $actionParamField.ItemSchema.RefName }}{{ end }}{{ else }}[]{{ $resName | title }}Create{{ $actionParamField.Name | title }}Request{{ end }}{{ end }}{{ else if eq $actionParamField.GoType "types.Map" }}map[string]interface{}{{ else if eq $actionParamField.Type "object" }}{{ if $actionParamField.RefName }}{{ if ne $pkgName "common" }}*common.{{ $actionParamField.RefName }}{{ else }}*{{ $actionParamField.RefName }}{{ end }}{{ else }}*{{ $resName | title }}Create{{ $actionParamField.Name | title }}Request{{ end }}{{ end }} `json:"{{ if eq $actionParamField.Type "array" }}-{{ else }}{{ $actionParamField.Name }}{{ end }}{{ if and (ne $actionParamField.Type "array") (ne $actionParamField.Type "object") }},omitempty{{ end }}"`
}

{{- if eq $actionParamField.Type "array" }}
func (r {{ $resName | title }}{{ $action.Name | title }}ActionRequest) MarshalJSON() ([]byte, error) {
	return json.Marshal(r.{{ $actionParamField.Name | title }})
}
{{- end }}

{{ template "sdkNestedStructs" dict "Fields" (makeSlice $actionParamField) "Prefix" (printf "%sCreate" ($resName | title)) "Package" $pkgName }}
{{- end }}
{{- end }}

type {{ .Name | title }}Response struct {
	UUID *string `json:"uuid"`
	{{ template "sdkResponseStructFields" dict "Fields" .ResponseFields "Prefix" (.Name | title) "Package" $.Package }}
}
{{ template "sdkResponseNestedStructs" dict "Fields" .ResponseFields "Prefix" (.Name | title) "Package" $.Package }}

func (r *{{ .Name | title }}Response) GetState() string {
	{{- $hasState := false }}
	{{- range .ResponseFields }}
	{{- if eq .Name "state" }}
	{{- $hasState = true }}
	{{- end }}
	{{- end }}

	{{- if $hasState }}
	if r.State != nil {
		return *r.State
	}
	{{- end }}
	return "OK"
}

func (r *{{ .Name | title }}Response) GetErrorMessage() string {
	{{- $hasError := false }}
	{{- range .ResponseFields }}
	{{- if eq .Name "error_message" }}
	{{- $hasError = true }}
	{{- end }}
	{{- end }}

	{{- if $hasError }}
	if r.ErrorMessage != nil {
		return *r.ErrorMessage
	}
	{{- end }}
	return ""
}

{{ end }}
